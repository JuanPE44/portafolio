---
import "../styles/2048.css";
import ButtonRow from "./ButtonRow.astro";
---

<div
  class="flex justify-center items-center bg-gray-bg rounded-2xl p-10 relative gap-4"
>
  <!--
  <div
    class="z-30 absolute top-0 left-0 w-full flex justify-center items-center h-full filter backdrop-blur-md rounded-2xl"
  >
    <button class="px-6 py-3 rounded-2xl bg-primary text-bold text-white"
      >Jugar</button
    >
  </div>
  -->
  <div
    id="header"
    class="flex flex-col p-3 rounded-2xl bg-gray-bg border-[#fff1] border-[1px]"
  >
    <h1 class="text-secondary text-6xl text-bold mb-2">2048</h1>
    <div class="container-score flex flex-col gap-2 font-bold">
      <div
        class="bg-gray-bg text-white p-1 rounded-2xl flex flex-col items-center gap-1"
      >
        <h3>SCORE</h3>
        <span id="score">0</span>
      </div>
      <div
        class="bg-gray-bg text-white p-1 rounded-2xl flex flex-col items-center gap-1"
      >
        <h3>BEST</h3>
        <span id="best-score">0</span>
      </div>
    </div>
    <div class="newgame flex flex-col mt-5">
      <div class="container-buttons flex gap-1">
        <ButtonRow id="row-left" className="-rotate-90" />
        <ButtonRow id="row-up" className="rotate-90" />
        <ButtonRow id="row-bottom" className="rotate-180" />
        <ButtonRow id="row-right" />
      </div>
      <button class="mt-5 px-4 py-3 rounded-2xl bg-primary text-bold text-white"
        >Nuevo juego</button
      >
    </div>
  </div>

  <div id="app">
    <div class="container-game flex gap-5 w-full"></div>
    <div class="board">
      <div class="container-win">
        <h1>YOU WON!</h1>
        <div class="win-score">Score: <span>1000</span></div>
        <button class="button-win">New Game</button>
      </div>
    </div>
  </div>

  <div
    class="bg-gray-bg p-3 border-[#fff1] border-[1px] h-full relative rounded-2xl text-white"
  >
    <h3 class="text-secondary text-3xl font-bold text-left mb-2">Como Jugar</h3>
    <p class="text-gray">
      Puedes mover las fichas en las cuatro direcciones (arriba, abajo,
      izquierda y derecha) utilizando las flechas del teclado.
    </p>
    <img src="/public/images/teclas.png" width="100" height="100" />
    <p class="text-gray">
      El objetivo del juego es combinar las fichas numeradas hasta alcanzar el
      n√∫mero 2048.
    </p>
  </div>
</div>

<script>
  const observer = new IntersectionObserver(
    async (entries) => {
      if (entries[0].isIntersecting) {
        observer.disconnect(); // Evita que se cargue varias veces

        const { Game } = await import("../projects/2048/Game.ts");
        console.log("juego cargado");
        if (localStorage.getItem("bestScore") === null) {
          let puntos: [] | number[] = [];
          localStorage.setItem("bestScore", JSON.stringify(puntos));
        }

        const g = new Game();

        const containerGame =
          document.querySelector<HTMLDivElement>(".container-game");

        containerGame?.appendChild(g.board.element!);
      }
    },
    { threshold: 0.2 }
  );

  observer.observe(document.getElementById("app")!);
</script>
